<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.EAS.mapper.TConContractwithouttextMapper">

    <select id="selectDatas" resultType="com.example.EAS.vo.NoTextContractVO">
        select bill.fid as id,bill.FNUMBER as num,bill.FNAME as title,
        bill.FBOOKEDDATE as bizDate,bill.FSTATE as state,
        bill.FCONTRACTTYPEID as contractTypeId,ct.FNAME_L2 as contractTypeName,
        bill.FProgrammingContract as programContractId,pc.FNAME_L2 as programContractName,
        bill.FCURRENCYID as currencyId,cur.FNAME_L2 as currencyName,
        bill.FAMOUNT as amount,bill.FORIGINALAMOUNT as oriAmount,
        sup.FNAME_L2 as receiverName,bill.FSIGNDATE as signDate,
        u.FNAME_L2 as creatorName,bill.FCREATETIME as createTime,
        bill.FPERSONID as personId,p.FNAME_L2 as personName
        from T_CON_CONTRACTWITHOUTTEXT bill
        left join T_FDC_ContractType ct on ct.fid=bill.FCONTRACTTYPEID
        left join T_CON_ProgrammingContract pc on pc.fid=bill.FProgrammingContract
        left join T_BD_CURRENCY cur on cur.fid=bill.FCURRENCYID
        left join t_bd_supplier sup on sup.fid=bill.FRECEIVEUNITID
        left join T_PM_USER u on u.fid=bill.FCREATORID
        left join T_BD_Person p on p.fid=bill.FPERSONID
        <where>
            and bill.FControlUnitID=#{orgId}
            <if test="projectIds != null and projectIds.size > 0">
                and bill.FCurProjectID in
                <foreach item="item" collection="projectIds" index="index" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="bizDate!=null and bizDate!=''">
                and bill.FBOOKEDDATE like CONCAT(CONCAT('%',#{bizDate}),'%')
            </if>
            <if test="num!=null and num!=''">
                and bill.fnumber like CONCAT(CONCAT('%',#{num}),'%')
            </if>
            <if test="title!=null and title!=''">
                and bill.fname like CONCAT(CONCAT('%',#{title}),'%')
            </if>
            <if test="contractTypeName!=null and contractTypeName!=''">
                and ct.FNAME_L2 like CONCAT(CONCAT('%',#{contractTypeName}),'%')
            </if>
            <if test="receiverName!=null and receiverName!=''">
                and sup.FNAME_L2 like CONCAT(CONCAT('%',#{receiverName}),'%')
                or p.FNAME_L2 like CONCAT(CONCAT('%',#{receiverName}),'%')
            </if>
            <if test="amount!=null and amount!=''">
                and bill.FAMOUNT like CONCAT(CONCAT('%',#{amount}),'%')
            </if>
            <if test="oriAmount!=null and oriAmount!=''">
                and bill.FORIGINALAMOUNT like CONCAT(CONCAT('%',#{oriAmount}),'%')
            </if>
        </where>
        order by bill.FBOOKEDDATE desc,bill.fnumber
    </select>
</mapper>
